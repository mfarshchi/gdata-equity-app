//
// ANZ Project for an Interview
//
// Equity Data Signal App By Mostafa Farshchi

import * as Highcharts from 'highcharts';
import {Component, OnInit, AfterContentInit, OnDestroy, ViewChild, ElementRef, AfterViewInit } from '@angular/core';
import { Equity } from './entities/equity/equity';
import { EquityService } from './entities/equity/equity.service';

@Component({
moduleId: module.id,
    templateUrl: 'home.component.html',
    styles: [`
             h1 {color: blue;}
             h4 {color: green;}
             .ui-g {
                text-align: center;
                background-color: aliceblue;}
             `]

})

export class HomeComponent implements OnInit, AfterContentInit, OnDestroy {
  @ViewChild('chartTarget') chartTarget: ElementRef;
  @ViewChild('chartDailyPrice') chartDailyPrice: ElementRef;

  chart: any;
  charDataApiCall : [number, number][];
  equityList : Equity[];

  charts: Highcharts.ChartObject;
 // const test = { bId: 1, date: '2017-1-1' };

  constructor(
              private equityService : EquityService
              ) {
  }

  ngOnInit() {
    //console.log(chartData.toString());
    //console.log(this.charDataApiCall.toString());
    this.equityService.findEquityQuery().
    subscribe(response => this.equityList = response);
  }
/*
  findEquityQuery() {
    this.equityService.findEquityQuery().
    subscribe(response => this.equityList = response);
    console.log("----------!!!!!!!!!!!!!!!!!!!- -------------");
    this.sleep(15000);
    console.log(this.equityList == null);

  }
*/
  sleep(ms) {
    var dt = new Date();
    while (Date.now() - dt.getTime() <= ms) {}
    return true;
  }


  ngAfterContentInit() {
    console.log("----------!!!!!!!!!!!!!!!!!!!- -------------");
    //this.sleep(15000);
    //console.log(this.equityList == null);

    //this.findEquityChart();
    //console.log(this.findEquityChart());
    //this.charDataApiCall = Equity.toChartData(this.equityList);

    console.log(this.equityService.directChartDate()
      .subscribe( data => {
        //now you have the data
        this.charDataApiCall = data

      })
    );
    const options: Highcharts.Options = {
      chart: {
        zoomType: 'x'
      },
      title: {
        text: 'Sample Chart - 2017 Close Price Rate of SymbolTicker: VLC - Values in AUD'
      },
      subtitle: {
        text: document.ontouchstart === undefined ?
          'Click and drag in the plot area to zoom in' : 'Pinch the chart to zoom in'
      },
      xAxis: {
        type: 'datetime'
      },
      yAxis: {
        title: {
          text: 'Equity Close Price'
        }
      },
      legend: {
        enabled: false
      },
      plotOptions: {
        area: {
          fillColor: {
            linearGradient: {
              x1: 0,
              y1: 0,
              x2: 0,
              y2: 1
            },
            stops: [
              [0, Highcharts.getOptions().colors[0]]
              [1, Highcharts.Color(Highcharts.getOptions().colors[0]).setOpacity(0).get('rgba')]
            ]
          },
          marker: {
            radius: 2
          },
          lineWidth: 1,
          states: {
            hover: {
              lineWidth: 1
            }
          },
          threshold: null
        }
      },
      /*
      series: [
        {
          "pricingDate": 1483405200000,
          "closePrice": 60.76
        },
        {
          "pricingDate": 1483923600000,
          "closePrice": 61.46
        },
        {
          "pricingDate": 1484010000000,
          "closePrice": 61.15
        }
      ],
      */
      series: [{
        type: 'area',
        name: 'Close Price',

        //data: chartData
        //data: [Equity.toChartData(this.equityService.findEquityQuery().subscribe(response => this.equityList = response))]
        //data: this.equityService.directChartDate().subscribe( data => })
        data: [[1483405200000,60.760000],[1483923600000,61.460000],[1484010000000,61.150000],[1484096400000,61.580000],[1484614800000,60.600000],[1484701200000,60.250000],[1484787600000,60.410000],[1484874000000,60.170000],[1485133200000,59.550000],[1485219600000,59.950000],[1485306000000,60.370000],[1485478800000,60.380000],[1485738000000,60.120000],[1485910800000,60.120000],[1485997200000,60.210000],[1486083600000,60.070000],[1486342800000,59.980000],[1486429200000,59.410000],[1486688400000,60.540000],[1486947600000,60.950000],[1487034000000,61.200000],[1487206800000,61.700000],[1487293200000,61.800000],[1487552400000,61.640000],[1487638800000,61.560000],[1487811600000,61.870000],[1488157200000,61.260000],[1488243600000,61.110000],[1488330000000,60.930000],[1488416400000,61.750000],[1488502800000,61.270000],[1488762000000,61.610000],[1488848400000,61.880000],[1489021200000,61.710000],[1489107600000,62.100000],[1489366800000,61.730000],[1489453200000,61.800000],[1489539600000,61.980000],[1489626000000,61.880000],[1490144400000,60.830000],[1490230800000,61.010000],[1490317200000,61.590000],[1490576400000,61.300000],[1490662800000,62.330000],[1490749200000,62.970000],[1490835600000,63.270000],[1490922000000,63.230000],[1491184800000,62.630000],[1491271200000,62.500000],[1491444000000,62.300000],[1491530400000,62.740000],[1491789600000,62.760000],[1491876000000,63.340000],[1491962400000,63.260000],[1492048800000,62.730000],[1492480800000,62.270000],[1492653600000,62.040000],[1492740000000,62.400000],[1492999200000,62.650000],[1493172000000,63.050000],[1493258400000,62.930000],[1493344800000,63.060000],[1493604000000,63.300000],[1493690400000,62.790000],[1493776800000,62.760000],[1493949600000,61.570000],[1494208800000,62.050000],[1494381600000,61.670000],[1494468000000,61.810000],[1494554400000,61.400000],[1494813600000,61.470000],[1494900000000,61.890000],[1494986400000,61.200000],[1495072800000,60.440000],[1495159200000,60.550000],[1495418400000,61.020000],[1495504800000,60.830000],[1496023200000,60.610000],[1496109600000,60.310000],[1496196000000,60.450000],[1496282400000,60.310000],[1496368800000,60.930000],[1496628000000,60.300000],[1496714400000,59.720000],[1496800800000,59.620000],[1496887200000,59.650000],[1496973600000,59.900000],[1497319200000,60.500000],[1497405600000,61.010000],[1497492000000,60.610000],[1497578400000,60.730000],[1497837600000,60.880000],[1497924000000,60.650000],[1498096800000,59.930000],[1498183200000,59.690000],[1498442400000,59.950000],[1498528800000,59.920000],[1498615200000,59.900000],[1498701600000,60.760000],[1498788000000,60.300000],[1499047200000,59.600000],[1499133600000,60.480000],[1499220000000,60.490000],[1499306400000,60.390000],[1499392800000,59.630000],[1499652000000,60.090000],[1499738400000,60.160000],[1499824800000,59.630000],[1499911200000,60.040000],[1500256800000,60.380000],[1500429600000,60.310000],[1500516000000,60.890000],[1500602400000,60.460000],[1500948000000,60.290000],[1501034400000,60.880000],[1501120800000,61.060000],[1501207200000,59.990000],[1501466400000,60.090000],[1501552800000,60.420000],[1501639200000,60.450000],[1501725600000,60.290000],[1502071200000,60.680000],[1502157600000,60.710000],[1502330400000,60.510000],[1502416800000,59.760000],[1502762400000,60.710000],[1502935200000,60.780000],[1503021600000,60.450000],[1503280800000,60.090000],[1503367200000,60.590000],[1503453600000,60.800000],[1503540000000,60.620000],[1503885600000,60.050000],[1503972000000,59.540000],[1504058400000,59.580000],[1504144800000,60.100000],[1504231200000,60.350000],[1504576800000,60.120000],[1504663200000,60.040000],[1504749600000,60.250000],[1504836000000,59.810000],[1505181600000,60.680000],[1505354400000,60.720000],[1505440800000,60.450000],[1505700000000,60.550000],[1505786400000,60.540000],[1506045600000,60.130000],[1506304800000,60.330000],[1506391200000,60.330000],[1506477600000,60.100000],[1506650400000,59.950000],[1506906000000,59.650000],[1507078800000,58.800000],[1507165200000,58.550000],[1507251600000,59.120000],[1507510800000,59.670000],[1507597200000,59.500000],[1507683600000,59.460000],[1507770000000,59.650000],[1507856400000,60.190000],[1508115600000,60.450000],[1508202000000,60.860000],[1508374800000,60.810000],[1508461200000,61.140000],[1508806800000,60.820000],[1508893200000,60.850000],[1508979600000,60.900000],[1509066000000,61.180000],[1509325200000,61.060000],[1509498000000,61.230000],[1509584400000,61.150000],[1509670800000,61.440000],[1509930000000,61.240000],[1510016400000,61.740000],[1510102800000,62.100000],[1510189200000,62.500000],[1510275600000,62.270000],[1510534800000,62.390000],[1510621200000,61.910000],[1510707600000,61.510000],[1510794000000,61.580000],[1510880400000,61.600000],[1511139600000,61.450000],[1511226000000,61.670000],[1511312400000,61.790000],[1511398800000,61.940000],[1511485200000,61.770000],[1511744400000,62.050000],[1511830800000,61.980000],[1512003600000,61.680000],[1512090000000,61.650000]]
      }]
    };

    this.chart = Highcharts.chart(this.chartDailyPrice.nativeElement, options);
  }

  ngOnDestroy() {
    this.chart = null;
  }
}
